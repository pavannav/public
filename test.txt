variable "psc_enabled" {
  description = "Enable PSC for this SQL instance"
  type        = bool
  default     = false
}

variable "psc_allowed_consumer_projects" {
  description = "List of consumer projects allowed to access via PSC"
  type        = list(string)
  default     = []
}
------
ip_configuration {
  ipv4_enabled    = false
  private_network = var.network

  dynamic "psc_config" {
    for_each = var.psc_enabled ? [1] : []
    content {
      psc_enabled               = true
      allowed_consumer_projects = var.psc_allowed_consumer_projects
    }
  }
}

----------
module "sql" {
  source = "./modules/sql"

  psc_enabled = true
  psc_allowed_consumer_projects = ["project-1", "project-2"]
}


=================

dynamic "authorized_networks" {
  for_each = var.psc_enabled || var.authorized_networks == null ? {} : var.authorized_networks
  iterator = network
  content {
    name  = network.key
    value = network.value
  }
}


enable_private_path_for_google_cloud_services = var.psc_enabled ? false : var.enable_private_path_for_google_cloud_services



